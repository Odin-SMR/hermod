#!/usr/bin/python
import sys,os,datetime

error = False

print "### Hermod system information:"
print "###"
print "###",str(datetime.datetime.now())
print "###"

for i in os.uname():
  print "###",i

print "###"

for i in sys.argv:
  print "###",i

print "###"
try:
    top = '/tmp/tmp%s' % (sys.argv[1].split('.')[0])
except IndexError,inst:
    print >> sys.stderr, "Can't find argument with jobid", inst
    sys.exit(1)
try:
    for root, dirs, files in os.walk(top, topdown=False):
            for name in files:
                    os.remove(os.path.join(root, name))
            for name in dirs:
                os.rmdir(os.path.join(root, name))
    os.rmdir(top)
except EnvironmentError,inst:
    if inst.errno==2:
        print "###",'Tempdir %s already deleted' % (inst.filename)
        error = True
    else:
        print >> sys.stderr, "Can't delete tempdir:",inst.errno,inst.strerror,inst.filename
        print "Can't delete tempdir:"
        sys.exit(2)
if not error:
    print "### Deleted tempdir",top
print "###"
sys.exit(0)
